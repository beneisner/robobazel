load("@rules_foreign_cc//tools/build_defs:cmake.bzl", "cmake_external")
licenses(["notice"])

filegroup(name = "all", srcs = glob(["**"]), visibility = ["//visibility:public"])

config_setting(
    name = "osx",
    constraint_values = [
        "@bazel_tools//platforms:osx",
    ],
)

config_setting(
    name = "linux",
    constraint_values = [
        "@bazel_tools//platforms:linux",
    ],
)

cmake_external(
    name = "folly",
    lib_source = "@com_facebook_folly//:all",
    cache_entries = select({
        ":osx": {
            "OPENSSL_ROOT_DIR": "/usr/local/opt/openssl",
            "DOUBLE_CONVERSION_INCLUDE_DIR": "$EXT_BUILD_DEPS/include",
            "DOUBLE_CONVERSION_LIBRARY": "$EXT_BUILD_DEPS/lib",
            "LIBGFLAGS_INCLUDE_DIR": "$EXT_BUILD_DEPS/include",
            "LIBGFLAGS_LIBRARY": "$EXT_BUILD_DEPS/lib",
            "GLOG_INCLUDE_DIRS": "$EXT_BUILD_DEPS/include",
            "GLOG_LIBRARY": "$EXT_BUILD_DEPS/lib",
        },
    }),
    deps = [
        "@com_github_google_double_conversion//:double-conversion",
        "@com_github_gflags_gflags//:gflags",
        "@com_github_google_glog//:glog",
    ],
    static_libraries = ["libfolly.a"],

)
